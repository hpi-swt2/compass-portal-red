<% content_for :title, "HPI Map" %>
<% content_for :head do %>
    <%= stylesheet_link_tag 'map' %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.76.0/dist/L.Control.Locate.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />

    <% # Inject outdoor geometry & generate building data %>
    <%= javascript_pack_tag 'OutdoorMap/geometry' %>
    <script>
      window.roomsToBuild = [
          <% @buildings.each do |building|%>
          <% building.rooms.each do |room|%>
          {
              'fullName': '<%= room.full_name %>',
              'geoJson': <%= raw(JSON.generate(room.to_geojson)) %>
          },
          <% end %>
          <% end %>
      ]
    </script>

    <% # Inject coordinates of selected room %>
    <script type="text/javascript" charset="utf-8">
        selected_room_coordinates = <%= @selected_room.visual_center_coordinates %>
    </script>
  <% end %>

  <body>
  	<div class="leaflet">
  		<div id="map" style="width: 100%; height: 600px;"></div>
      <%= javascript_pack_tag 'OutdoorMap/map_build' %>
      <%= javascript_pack_tag 'indoorMap' %>
	  </div>

    <% if @selected_room.present? %>
		  <%= render 'partials/map_popup', :locals => {:room => @selected_room}%>
      <%= javascript_pack_tag 'selected_room' %>
    <% end %>
  </body>
</html>